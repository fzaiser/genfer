import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns

from matplotlib import cm

traj = np.array([
    [0.98126875, 0.99990625, 1.09375   , 0.99653875],
    [0.94267875, 0.99019052, 1.07658458, 0.97537467],
    [0.91576948, 0.98955072, 1.10867779, 0.99005013],
    [0.89103868, 0.99030323, 1.13815044, 0.99005001],
    [0.87099146, 0.99106768, 1.16495579, 0.99003716],
    [0.85600435, 0.99148531, 1.1851862 , 0.99033668],
    [0.84577658, 0.99155392, 1.20045462, 0.99062113],
    [0.83785428, 0.99158219, 1.21120725, 0.99083448],
    [0.83234693, 0.99158293, 1.21913311, 0.99097999],
    [0.8284821 , 0.99156585, 1.22484185, 0.99108777],
    [0.82579349, 0.99153634, 1.22887738, 0.99116078],
    [0.82391024, 0.99149885, 1.23164595, 0.99120821],
    [0.82267493, 0.99145726, 1.23356076, 0.9912358 ],
    [0.82173903, 0.99141414, 1.23473514, 0.99124721],
    [0.82090242, 0.99137071, 1.23512337, 0.99124668],
    [0.82039488, 0.9913295 , 1.23506472, 0.99123799],
    [0.82010134, 0.99129069, 1.23470427, 0.99122335],
    [0.81995339, 0.99125432, 1.23416128, 0.9912046 ],
    [0.81990128, 0.99122024, 1.23352249, 0.99118318],
    [0.81990878, 0.99118822, 1.23284798, 0.99116017],
    [0.81995026, 0.99115802, 1.232177  , 0.99113635],
    [0.82000845, 0.99112943, 1.23153314, 0.99111227],
    [0.82007235, 0.99110226, 1.23092884, 0.99108832],
    [0.82013553, 0.99107637, 1.23036905, 0.99106473],
    [0.82019462, 0.99105162, 1.22985411, 0.99104167],
    [0.82024819, 0.99102793, 1.22938174, 0.99101924],
    [0.82029599, 0.99100521, 1.22894839, 0.99099748],
    [0.82033832, 0.99098339, 1.22855012, 0.99097643],
    [0.82037577, 0.99096243, 1.22818308, 0.99095609],
    [0.82040898, 0.99094227, 1.22784371, 0.99093644],
    [0.82043857, 0.99092287, 1.22752886, 0.99091748],
    [0.82046508, 0.99090418, 1.22723582, 0.99089918],
    [0.82048897, 0.99088618, 1.22696221, 0.99088151],
    [0.82051064, 0.99086882, 1.22670604, 0.99086446],
    [0.82053039, 0.99085207, 1.22646555, 0.99084799],
    [0.82054847, 0.99083591, 1.22623926, 0.99083208],
    [0.82056512, 0.99082031, 1.22602584, 0.99081671],
    [0.8205805 , 0.99080523, 1.22582418, 0.99080185],
    [0.82059476, 0.99079065, 1.22563326, 0.99078747],
    [0.82060804, 0.99077656, 1.2254522 , 0.99077356],
    [0.82062043, 0.99076292, 1.22528022, 0.99076009],
    [0.82063202, 0.99074971, 1.22511661, 0.99074704],
    [0.82064291, 0.99073692, 1.22496076, 0.9907344 ],
    [0.82065315, 0.99072452, 1.22481209, 0.99072214],
    [0.82066281, 0.9907125 , 1.22467009, 0.99071025],
    [0.82067194, 0.99070084, 1.22453432, 0.99069871],
    [0.82068059, 0.99068952, 1.22440435, 0.99068751],
    [0.82068879, 0.99067854, 1.2242798 , 0.99067663],
    [0.82069658, 0.99066787, 1.22416033, 0.99066606],
    [0.820704  , 0.9906575 , 1.22404561, 0.99065579],
    [0.82071107, 0.99064742, 1.22393537, 0.9906458 ],
    [0.82071782, 0.99063762, 1.22382933, 0.99063608],
    [0.82072427, 0.99062808, 1.22372725, 0.99062662],
    [0.82073045, 0.99061879, 1.22362891, 0.99061741],
    [0.82073637, 0.99060976, 1.22353408, 0.99060844],
    [0.82074205, 0.99060095, 1.22344259, 0.9905997 ],
    [0.82074859, 0.99059665, 1.22335691, 0.9904657 ],
    [0.82075211, 0.99058412, 1.22327021, 0.99057295],
    [0.82075776, 0.99057579, 1.22318648, 0.99057415],
    [0.82076268, 0.99056789, 1.22310656, 0.99056693],
    [0.82076738, 0.99056014, 1.22302929, 0.99055919],
    [0.8207734 , 0.99055143, 1.22295575, 0.9904661 ],
    [0.82077613, 0.99054465, 1.22288253, 0.99053511],
    [0.82078143, 0.99053431, 1.22281149, 0.99049627],
    [0.82078395, 0.99053256, 1.22274399, 0.99054414],
    [0.82078909, 0.99052112, 1.22267763, 0.99048845],
    [0.82079076, 0.99052192, 1.22261375, 0.99055578],
    [0.82079404, 0.99051769, 1.22255142, 0.99055354],
    [0.82080045, 0.99050086, 1.22249014, 0.99046771],
    [0.82080304, 0.9904973 , 1.22243131, 0.99049087],
    [0.82080695, 0.99048745, 1.22237413, 0.99046401],
    [0.82081003, 0.9904853 , 1.22231822, 0.99046511],
    [0.82081575, 0.99047006, 1.22226296, 0.99040142],
    [0.82081554, 0.99047556, 1.22221057, 0.99048307],
    [0.8208191 , 0.99046781, 1.22215918, 0.99046042],
    [0.820821  , 0.99046447, 1.2221095 , 0.99047019],
    [0.82082073, 0.9904733 , 1.22205957, 0.99054615],
    [0.82082559, 0.9904599 , 1.22201213, 0.99048786],
    [0.82083051, 0.9904452 , 1.22196512, 0.99044306],
    [0.82083305, 0.99044071, 1.22192001, 0.99043407],
    [0.82083191, 0.99045051, 1.22187552, 0.99049665],
    [0.82083698, 0.9904343 , 1.22183179, 0.99045085],
    [0.8208409 , 0.99042656, 1.22178981, 0.99041399],
    [0.82084525, 0.99041269, 1.22174845, 0.99038193],
    [0.82084704, 0.9904105 , 1.22170758, 0.9903911 ],
    [0.82085191, 0.99040127, 1.22166694, 0.99036049],
    [0.82085347, 0.99039774, 1.22162926, 0.9903604 ],
    [0.82085037, 0.99040795, 1.22159163, 0.99042189],
    [0.8208591 , 0.99038792, 1.22155426, 0.99034286],
    [0.82085627, 0.99039592, 1.22151729, 0.99040011],
    [0.82085754, 0.99039237, 1.22148326, 0.99039265],
    [0.82086441, 0.99037722, 1.22144823, 0.99034224],
    [0.82086479, 0.99037344, 1.22141375, 0.9903609 ],
    [0.8208601 , 0.99039424, 1.22138054, 0.99040823],
    [0.82087295, 0.99035764, 1.22134728, 0.99032334],
    [0.82086696, 0.99037333, 1.22131662, 0.99037025],
    [0.82087338, 0.99035977, 1.22128505, 0.99033258],
    [0.82087684, 0.99034982, 1.22125462, 0.9903223 ],
    [0.82087705, 0.99034993, 1.22122448, 0.99032979],
    [0.82087911, 0.99034531, 1.2211948 , 0.99032666],
    [0.82088194, 0.99033898, 1.22116586, 0.99031918]
])

res = 512

X = np.arange(0.5, 1.0, 1/res)
Y = np.arange(0.5, 1.0, 1/res)
x0, x1 = np.meshgrid(X, Y)
obj = np.log(1.0 / (1 - x0) / (1 - x1))
dx0 = (np.roll(obj[::2, ::2], 1, axis=0) - obj[::2, ::2]) * res
dx1 = (np.roll(obj[::2, ::2], 1, axis=1) - obj[::2, ::2]) * res

obj = np.where(0.4 + 0.6 * x0 ** 2 <= x0 * x1, obj, np.nan)
dx0 = np.where(0.4 + 0.6 * x0[::2, ::2] ** 2 <= x0[::2, ::2] * x1[::2, ::2], dx0, np.nan)
dx1 = np.where(0.4 + 0.6 * x0[::2, ::2] ** 2 <= x0[::2, ::2] * x1[::2, ::2], dx1, np.nan)

im = plt.imshow(
    obj,
    extent=(0.5, 1, 0.5, 1),
    origin='lower',
    cmap='coolwarm',
    interpolation='nearest',)
plt.colorbar(im)

# plot gradients as vector field:
# plt.quiver(x0[::2, ::2], x1[::2, ::2], dx0, dx1, scale=1e4)

plt.plot(traj[:,0], traj[:,1], '<-')
plt.plot(traj[0, 0], traj[0,1], 'ro', label='start')
plt.plot(traj[-1, 0], traj[-1,1], 'go', label='end')

plt.show()
